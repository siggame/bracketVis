(function(){var a,b,c,d,e,f,g,h,i=function(a,b){return function(){return a.apply(b,arguments)}};e=function(){function a(a,b){this.name=a,this.health=b,null==this.name&&(this.name=null),null==this.health&&(this.health=null)}return a}(),f=function(){function a(a){this.player=a,this.is_slot=function(){return!0},this.visible=!1,this.isVisible=function(){return this.visible}}return a}(),a=function(){function a(){this.lastmatch=null,this.matches={}}return a.prototype.isChampBracket=function(){return!1},a}(),g=function(){function a(){this.x=0,this.y=0,this.w=0,this.h=0}return a}(),d=function(){function a(a){this.bracketViewer=a,this.onclick=i(this.onclick,this),this.lastmatch=null,this.matches={},this.tourneydata=null,this.brack1=null,this.brack2=null,this.brack3=null,this.currentSeries="",this.showMatchupb2b3=!1,this.showChamp=!1,this.semiWinner,this.champWinner,this.newCoordx=($(window).width()-5)/1e3,this.newCoordy=($(window).height()-5)/1e3,this.buttonWidth=100*this.newCoordx,this.buttonHeight=80*this.newCoordy,this.matchPageNext=new c,this.matchPageNext.pos.x=900*this.newCoordx-this.buttonWidth/2,this.matchPageNext.pos.y=500*this.newCoordy-this.buttonHeight/2,this.matchPageNext.pos.w=this.buttonWidth,this.matchPageNext.pos.h=this.buttonHeight,this.matchPageNext.text="Next",this.matchPageNext.color="#AAAAAA",this.matchPageNext.func=function(a){return function(){var b,c,d;return a.currentMatchid=a.currentMatch.subsequent_matches[0],a.currentMatch=a.matches[a.currentMatch.subsequent_matches[0]],c=!0,d=a.matches[a.currentMatch.subsequent_matches[0]],d.player_1!==a.currentMatch.player_1&&d.player_1!==a.currentMatch.player_2||d.player_2!==a.currentMatch.player_1&&d.player_2!==a.currentMatch.player_2||(c=!1),b=a.bracketViewer.drawMatchPageFunc(a.currentMatchid,a.currentMatch,function(b,d){return a.matchPagePrev.ifClick(b,d),c?void 0:a.matchPageNext.ifClick(b,d)},function(){return console.log("yo"),"no game log"===d.log_location?("champ"===a.currentSeries?(a.showChamp=!0,a.champWinner=a.currentMatch.winner):(a.showMatchupb2b3=!0,a.semiWinner=a.currentMatch.winner),c=!0):void 0}),a.bracketViewer.currentDrawFunction=function(d){return b(),a.matchPagePrev.draw(d),c?void 0:a.matchPageNext.draw(d)},a.bracketViewer.redraw()}}(this),this.matchPagePrev=new c,this.matchPagePrev.pos.x=100*this.newCoordx-this.buttonWidth/2,this.matchPagePrev.pos.y=500*this.newCoordy-this.buttonHeight/2,this.matchPagePrev.pos.w=this.buttonWidth,this.matchPagePrev.pos.h=this.buttonHeight,this.matchPagePrev.text="Prev",this.matchPagePrev.color="#AAAAAA",this.matchPagePrev.func=function(a){return function(){var b,c;return a.currentMatchid=a.currentMatch.previous_matches[0],a.currentMatch=a.matches[a.currentMatch.previous_matches[0]],c=!1,(a.currentMatchid===parseInt(a.champFirstMatchid)||a.currentMatchid===parseInt(a.semiFirstMatchid))&&(c=!0),b=a.bracketViewer.drawMatchPageFunc(a.currentMatchid,a.currentMatch,function(b,d){return c||a.matchPagePrev.ifClick(b,d),a.matchPageNext.ifClick(b,d)}),a.bracketViewer.currentDrawFunction=function(d){return b(),c||a.matchPagePrev.draw(d),a.matchPageNext.draw(d)},a.bracketViewer.redraw()}}(this),this.champMatchup=new c,this.champMatchup.pos.x=500*this.newCoordx-this.buttonWidth/2,this.champMatchup.pos.y=200*this.newCoordy-this.buttonHeight/2,this.champMatchup.pos.w=this.buttonWidth,this.champMatchup.pos.h=this.buttonHeight,this.champMatchup.text="",this.champMatchup.color="#AAAAAA",this.champMatchup.func=function(a){return function(){var b;return a.currentSeries="champ",a.currentMatchid=a.champFirstMatchid,a.currentMatch=a.champFirstMatch,b=a.bracketViewer.drawMatchPageFunc(a.champFirstMatchid,a.champFirstMatch,function(b,c){return a.matchPageNext.ifClick(b,c)}),a.bracketViewer.currentDrawFunction=function(c){return b(),a.matchPageNext.draw(c)},a.bracketViewer.redraw()}}(this),this.b1Winner=new c,this.b1Winner.pos.x=500*this.newCoordx-this.buttonWidth/2-2*this.buttonWidth,this.b1Winner.pos.y=400*this.newCoordy-this.buttonHeight/2,this.b1Winner.pos.w=this.buttonWidth,this.b1Winner.pos.h=this.buttonHeight,this.b1Winner.text="",this.b1Winner.color="#AAAAAA",this.matchupb2b3=new c,this.matchupb2b3.pos.x=500*this.newCoordx-this.buttonWidth/2+2*this.buttonWidth,this.matchupb2b3.pos.y=400*this.newCoordy-this.buttonHeight/2,this.matchupb2b3.pos.w=this.buttonWidth,this.matchupb2b3.pos.h=this.buttonHeight,this.matchupb2b3.color="#AAAAAA",this.matchupb2b3.text="",this.matchupb2b3.func=function(a){return function(){var b,c,d;return a.currentSeries="semi",a.currentMatchid=a.semiFirstMatchid,a.currentMatch=a.semiFirstMatch,d=a.matches[a.currentMatch.subsequent_matches[0]],c=!1,b=a.bracketViewer.drawMatchPageFunc(a.semiFirstMatchid,a.semiFirstMatch,function(b,d){return c?void 0:a.matchPageNext.ifClick(b,d)},function(){return"no game log"===d.log_location?(a.semiWinner=a.currentMatch.winner,a.showMatchupb2b3=!0,c=!0):void 0}),a.bracketViewer.currentDrawFunction=function(d){return b(),c?void 0:a.matchPageNext.draw(d)},a.bracketViewer.redraw()}}(this),this.b2Winner=new c,this.b2Winner.pos.x=500*this.newCoordx-this.buttonWidth/2,this.b2Winner.pos.y=650*this.newCoordy-this.buttonHeight/2,this.b2Winner.pos.w=this.buttonWidth,this.b2Winner.pos.h=this.buttonHeight,this.b2Winner.color="#AAAAAA",this.b2Winner.text="",this.b3Winner=new c,this.b3Winner.pos.x=500*this.newCoordx-this.buttonWidth/2+4*this.buttonWidth,this.b3Winner.pos.y=650*this.newCoordy-this.buttonHeight/2,this.b3Winner.pos.w=this.buttonWidth,this.b3Winner.pos.h=this.buttonHeight,this.b3Winner.color="#AAAAAA",this.b3Winner.text=""}return a.prototype.isChampBracket=function(){return!0},a.prototype.onclick=function(a){var b,c,d,e,f,g;for(c=$(window).offset(),this.champMatchup.ifClick(a.clientX,a.clientY),this.matchupb2b3.ifClick(a.clientX,a.clientY),f=this.bracketViewer.brackButtons,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(b.ifClick(a.clientX,a.clientY));return g},a.prototype.processMatches=function(){var a,b,c,d;this.brack1Winner=this.brack1.matches[this.brack1.lastmatch].winner,this.brack2Winner=this.brack2.matches[this.brack2.lastmatch].winner,this.brack3Winner=this.brack3.matches[this.brack3.lastmatch].winner,c=this.matches,d=[];for(a in c)b=c[a],b.previous_matches[0]!==b.previous_matches[1]?b.player_1===this.brack1Winner||b.player_2===this.brack1Winner?(this.champFirstMatchid=a,d.push(this.champFirstMatch=b)):(this.semiFirstMatchid=a,d.push(this.semiFirstMatch=b)):d.push(void 0);return d},a.prototype.draw=function(a){var b,c,d,e,f,g,h;return b=this.brack1.matches[this.brack1.lastmatch].winner,this.brack1.matches[this.brack1.lastmatch].isVisible()&&(this.b1Winner.text=this.brack1.matches[this.brack1.lastmatch].winner),this.brack2.matches[this.brack2.lastmatch].isVisible()&&(this.b2Winner.text=this.brack2.matches[this.brack2.lastmatch].winner),this.brack3.matches[this.brack3.lastmatch].isVisible()&&(this.b3Winner.text=this.brack3.matches[this.brack3.lastmatch].winner),this.showMatchupb2b3&&(this.matchupb2b3.text=this.semiWinner),this.showChamp&&(this.champMatchup.text=this.champWinner),this.champMatchup.draw(a),this.matchupb2b3.draw(a),this.b1Winner.draw(a),this.b2Winner.draw(a),this.b3Winner.draw(a),a.strokeStyle="#000000",a.lineWidth=1,c=function(b){return function(b,c,d,e){return a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.stroke()}}(this),d=this.b1Winner.pos.x+this.buttonWidth/2,g=this.b1Winner.pos.y,h=this.champMatchup.pos.y+this.buttonHeight+(this.b1Winner.pos.y-(this.champMatchup.pos.y+this.buttonHeight))/2,c(d,g,d,h),d=this.champMatchup.pos.x+this.buttonWidth/2,g=this.champMatchup.pos.y+this.buttonHeight,c(d,g,d,h),d=this.matchupb2b3.pos.x+this.buttonWidth/2,g=this.matchupb2b3.pos.y,c(d,g,d,h),e=this.b1Winner.pos.x+this.buttonWidth/2,f=this.matchupb2b3.pos.x+this.buttonWidth/2,c(e,h,f,h),d=this.b2Winner.pos.x+this.buttonWidth/2,g=this.b2Winner.pos.y,h=this.matchupb2b3.pos.y+this.buttonHeight+(this.b2Winner.pos.y-(this.matchupb2b3.pos.y+this.buttonHeight))/2,c(d,g,d,h),d=this.matchupb2b3.pos.x+this.buttonWidth/2,g=this.matchupb2b3.pos.y+this.buttonHeight,c(d,g,d,h),d=this.b3Winner.pos.x+this.buttonWidth/2,g=this.b3Winner.pos.y,c(d,g,d,h),e=this.b2Winner.pos.x+this.buttonWidth/2,f=this.b3Winner.pos.x+this.buttonWidth/2,c(e,h,f,h)},a}(),c=function(){function a(){this.pos=new g,this.text="Reveal",this.textHeight="14px",this.color="#000000",this.func=null}return a.prototype.ifClick=function(a,b){return a>this.pos.x&&a<this.pos.x+this.pos.w&&b>this.pos.y&&b<this.pos.y+this.pos.h&&null!==this.func?this.func():void 0},a.prototype.click=function(){return null!==this.func?this.func():void 0},a.prototype.draw=function(a){var b,c;for(a.beginPath(),a.rect(this.pos.x,this.pos.y,this.pos.w,this.pos.h),a.fillStyle=this.color,a.strokeStyle="#000000",a.fill(),a.stroke(),a.font="18px Verdana",a.textAlign="center",a.textBaseline="middle",a.fillStyle="#000000",b=0,c=0;a.measureText(this.text.substring(0,b+1)).width<this.pos.w&&this.text.substring(0,b)!==this.text;)b++;if(this.text.substring(0,b)!==this.text)for(c=b;a.measureText(this.text.substring(b,c+1)).width<this.pos.w&&!(c>=this.text.length);)c++;return 0===c?a.fillText(this.text.substring(0,b),this.pos.x+this.pos.w/2,this.pos.y+this.pos.h/2):(a.fillText(this.text.substring(0,b),this.pos.x+this.pos.w/2,this.pos.y+this.pos.h/2-10),a.textAlign="left",a.fillText(this.text.substring(b,c),this.pos.x,this.pos.y+this.pos.h/2+10))},a}(),b=function(){function b(){this.redraw=i(this.redraw,this),this.resize=i(this.resize,this),this.depthRecurse=i(this.depthRecurse,this),this.drawBracket=i(this.drawBracket,this),this.drawMatch=i(this.drawMatch,this),this.drawPlayerSlot=i(this.drawPlayerSlot,this),this.drop=i(this.drop,this),this.onclick=i(this.onclick,this),this.drawBracketFunc=i(this.drawBracketFunc,this),this.drawMatchPageFunc=i(this.drawMatchPageFunc,this);var b;this.canvas=document.getElementById("tourneyViewer"),this.tourneyData=null,this.bracket1=new a,this.bracket2=new a,this.bracket3=new a,this.champBracket=new d(this),this.champBracket.brack1=this.bracket1,this.champBracket.brack2=this.bracket2,this.champBracket.brack3=this.bracket3,this.rectStroke="#000000",this.rectFill="#AAAAAA",this.rectWidth=110,this.rectHeight=40,this.textHeight="14px",this.fileLoaded=!1,this.currentDrawFunction=null,this.currentBracket=null,this.brackButtons=[],this.brackButtons.push(new c),this.brackButtons.push(new c),this.brackButtons.push(new c),this.brackButtons.push(new c);try{this.context=this.canvas.getContext("2d")}catch(e){throw{Message:"Failure to get canvas context."}}b=document.getElementById("mainContent"),$(b).bind("dragover",function(a){return a.stopPropagation(),a.preventDefault()}),$(b).bind("drop",this.drop),$(window).resize(this.resize),$(this.canvas).on("click",this.onclick),this.resize()}return b.prototype.drawMatchPageFunc=function(a,b,d,e){var f,g,h,i,j,k;return"undefined"==typeof d&&(d=function(){}),"undefined"==typeof e&&(e=function(){}),j=new c,j.pos.w=120,j.pos.h=60,j.pos.x=.5*this.canvas.width-j.pos.w/2,j.pos.y=.9*this.canvas.height-j.pos.h/2,j.text="Reveal",j.color="#AAAAAA",j.func=function(c){return function(){var d;return c.tourneyData[a].visible=!0,null!=c.bracket2.matches[a]&&(c.bracket2.matches[a].visible=!0),null!=c.bracket3.matches[a]&&(c.bracket3.matches[a].visible=!0),d=function(a,b){var e,f,g,h;return b.visible=!0,null!=c.bracket2.matches[a]&&(c.bracket2.matches[a].visible=!0),null!=c.bracket3.matches[a]&&(c.bracket3.matches[a].visible=!0),0!==b.previous_matches.length?(f=b.previous_matches[0].toString(),h=b.previous_matches[1].toString(),e=c.tourneyData[f],g=c.tourneyData[h],d(f,e),d(h,g)):void 0},d(a,b),e(),c.redraw()}}(this),i=this.currentBracket,f=new c,f.pos.w=60,f.pos.h=40,f.pos.x=.15*this.canvas.width-f.pos.w/2,f.pos.y=.15*this.canvas.height-f.pos.h/2,f.text="Back",f.color="#AAAAAA",f.func=function(a){return function(){return i.isChampBracket()?(a.currentDrawFunction=a.drawChampBracket,$(a.canvas).off("click"),$(a.canvas).on("click",a.champBracket.onclick)):(a.currentDrawFunction=a.drawBracketFunc(i),$(a.canvas).off("click"),$(a.canvas).on("click",a.onclick)),a.redraw()}}(this),k=new c,k.pos.w=120,k.pos.h=80,k.pos.x=.5*this.canvas.width-k.pos.w/2,k.pos.y=.7*this.canvas.height-k.pos.h/2,k.text="Play Game",k.color="#AAFFAA",k.func=function(a){return function(){return window.open("http://vis.megaminerai.com/#/?logUrl="+encodeURIComponent(b.log_location),"_blank")}}(this),h=function(a){return function(b){var c,e,g;return c=$(a.canvas).offset(),e=b.clientX-c.left,g=b.clientY-c.top,j.ifClick(e,g),f.ifClick(e,g),k.ifClick(e,g),d(e,g)}}(this),$(this.canvas).off("click"),$(this.canvas).on("click",h),g=function(c){return function(){var d,e,g,h,i;return f.draw(c.context),j.draw(c.context),k.draw(c.context),e=b.player_1,g=b.player_2,c.context.font="30px Verdana",c.context.textAlign="left",c.context.fillStyle="#000000",h=.2*c.canvas.width,i=.5*c.canvas.height,d=.45*c.canvas.width-.2*c.canvas.width,c.context.fillText(e,h,i,d),h=.8*c.canvas.width,i=.5*c.canvas.height,c.context.textAlign="right",c.context.fillText(g,h,i,d),h=.9*c.canvas.width,i=.1*c.canvas.height,c.context.textAlign="left",c.context.fillText(a,h,i,d),b.isVisible()&&(c.context.font="30px Verdana",c.context.textAlign="center",c.context.fillStyle="#000000",h=.5*c.canvas.width,i=.3*c.canvas.height,c.context.fillText("Winner:",h,i),c.context.font="30px Verdana",c.context.textAlign="center",c.context.fillStyle="#FF0000",i+=33,c.context.fillText(b.winner,h,i)),c.context.textAlign="center",c.context.fillStyle="#ff0000",h=.5*c.canvas.width,i=.5*c.canvas.height,c.context.fillText(".vs",h,i)}}(this)},b.prototype.drawBracketFunc=function(a){var b;return $(this.canvas).off("click"),$(this.canvas).on("click",this.onclick),b=function(b){return function(){return b.drawBracket(a)}}(this)},b.prototype.onclick=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(this.fileLoaded){j=this.tourneyData;for(c in j)d=j[c],d.is_slot()||(e=$(this.canvas).offset(),f=a.clientX-e.left,g=a.clientY-e.top,f>d.click_field.x&&f<d.click_field.x+d.click_field.w&&g>d.click_field.y&&g<d.click_field.y+d.click_field.h&&(this.currentDrawFunction=this.drawMatchPageFunc(c,d),this.redraw()));for(k=this.brackButtons,l=[],h=0,i=k.length;i>h;h++)b=k[h],l.push(b.ifClick(f,g));return l}},b.prototype.drop=function(a){var b,c,d,e;if(console.log("wakka"),a.stopPropagation(),a.preventDefault(),d=a.originalEvent.dataTransfer.files,1!==d.length)throw{Message:"Multiple files dropped"};if(b=d[0],c=escape(b.name),!/\.json$/.test(c))throw{Message:"Needs to be a JSON file"};return e=new FileReader,e.onload=function(a){return function(b){return a.tourneyData=JSON.parse(b.target.result),console.info("File loaded"),a.createBrackets()}}(this),e.readAsText(b)},b.prototype.createBrackets=function(){var a,b,c,d,e,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W;this.champBracket.tourneydata=this.tourneyData,E=this.tourneyData;for(a in E)e=E[a],e.is_slot=function(){return!1},null==e.subsequent_matches&&(e.subsequent_matches=[]),e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v],null==s.subsequent_matches&&(s.subsequent_matches=[]),null==u.subsequent_matches&&(u.subsequent_matches=[]),s.subsequent_matches.push(a),u.subsequent_matches.push(a)),e.click_field=new g,e.visible=!1,e.isVisible=function(){return this.visible};A={},F=this.tourneyData;for(a in F)e=F[a],0===e.previous_matches.length&&(this.bracket1.matches[a]=e,A[a]=e);for(p={};Object.keys(A).length>1;){P=this.tourneyData;for(a in P)if(e=P[a],e.previous_matches.length>0){t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v];for(B in A)C=A[B],(t===B&&(e.player_1===C.winner||e.player_2===C.winner)||v===B&&(e.player_1===C.winner||e.player_2===C.winner))&&(this.bracket1.matches[a]=e,p[a]=e)}A=p,p={}}for(a in A)e=A[a],this.bracket1.lastmatch=a;Q=this.tourneyData;for(a in Q)e=Q[a],e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v],c=s.winner===s.player_1?s.player_2:s.player_1,d=u.winner===u.player_1?u.player_2:u.player_1,j=!(null==this.bracket1.matches[t]||e.player_1!==c&&e.player_2!==c||null==this.bracket1.matches[v]||e.player_1!==d&&e.player_2!==d),j&&(this.bracket2.matches[a]=e));for(b=!0;b;){b=!1,R=this.tourneyData;for(a in R)e=R[a],e.previous_matches.length>0&&null==this.bracket2.matches[a]&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v],c=s.winner===s.player_1?s.player_2:s.player_1,d=u.winner===u.player_1?u.player_2:u.player_1,h=null!=this.bracket1.matches[t]&&(e.player_1===c||e.player_2===c)||null!=this.bracket1.matches[v]&&(e.player_1===d||e.player_2===d),n=null!=this.bracket2.matches[t]&&(e.player_1===s.winner||e.player_2===s.winner)||null!=this.bracket2.matches[v]&&(e.player_1===u.winner||e.player_2===u.winner),l=!(null==this.bracket2.matches[t]||e.player_1!==s.winner&&e.player_2!==s.winner||null==this.bracket2.matches[v]||e.player_1!==u.winner&&e.player_2!==u.winner),(h&&n||l)&&(b=!0,this.bracket2.matches[a]=e))}S=this.bracket2.matches;for(a in S){for(e=S[a],q=a,r=e,x=a,z=a,w=e,y=e;null!=this.bracket2.matches[x]||null!=this.bracket2.matches[z];){if(null!=this.bracket2.matches[x])q=x,r=w;else{if(null==this.bracket2.matches[z])break;q=z,r=y}x=r.subsequent_matches[0].toString(),z=r.subsequent_matches[1].toString(),w=this.tourneyData[x],y=this.tourneyData[z]}this.bracket2.lastmatch=q;break}T=this.tourneyData;for(a in T)e=T[a],e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v],c=s.winner===s.player_1?s.player_2:s.player_1,d=u.winner===u.player_1?u.player_2:u.player_1,k=!(null==this.bracket2.matches[t]||e.player_1!==c&&e.player_2!==c||null==this.bracket2.matches[v]||e.player_1!==d&&e.player_2!==d),k&&(this.bracket3.matches[a]=e));for(b=!0;b;){b=!1,U=this.tourneyData;for(a in U)if(e=U[a],e.previous_matches.length>0&&null==this.bracket3.matches[a]&&e.previous_matches[0]!==e.previous_matches[1]){if(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v],c=s.winner===s.player_1?s.player_2:s.player_1,d=u.winner===u.player_1?u.player_2:u.player_1,i=null!=this.bracket2.matches[t]&&(e.player_1===c||e.player_2===c)||null!=this.bracket2.matches[v]&&(e.player_1===d||e.player_2===d),o=null!=this.bracket3.matches[t]&&(e.player_1===s.winner||e.player_2===s.winner)||null!=this.bracket3.matches[v]&&(e.player_1===u.winner||e.player_2===u.winner),m=!(null==this.bracket3.matches[t]||e.player_1!==s.winner&&e.player_2!==s.winner||null==this.bracket3.matches[v]||e.player_1!==u.winner&&e.player_2!==u.winner),e.player_1===s.winner&&e.player_1===d||e.player_1===u.winner&&e.player_1===c||e.player_2===s.winner&&e.player_2===d||e.player_2===u.winner&&e.player_2===c)continue;(i&&o||m)&&(b=!0,this.bracket3.matches[a]=e)}}V=this.bracket3.matches;for(a in V){for(e=V[a],q=a,r=e,x=a,z=a,w=e,y=e;null!=this.bracket3.matches[x]||null!=this.bracket3.matches[z];){if(null!=this.bracket3.matches[x])q=x,r=w;else{if(null==this.bracket3.matches[z])break;q=z,r=y}x=r.subsequent_matches[0].toString(),w=this.tourneyData[x],2===r.subsequent_matches.length?(z=r.subsequent_matches[1].toString(),y=this.tourneyData[z]):(z=x,y=w)}this.bracket3.lastmatch=q;break}W=this.tourneyData;for(a in W)e=W[a],null==this.bracket1.matches[a]&&null==this.bracket2.matches[a]&&null==this.bracket3.matches[a]&&(this.champBracket.matches[a]=e);G=this.champBracket.matches;for(a in G)if(e=G[a],0===e.subsequent_matches.length){this.champBracket.lastmatch=a;break}this.champBracket.processMatches(),H=this.bracket2.matches;for(a in H)e=H[a],e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v],null==this.bracket2.matches[t]&&(s.winner===s.player_1?this.bracket2.matches[t]=new f(s.player_2):this.bracket2.matches[t]=new f(s.player_1)),null==this.bracket2.matches[v]&&(u.winner===u.player_1?this.bracket2.matches[v]=new f(u.player_2):this.bracket2.matches[v]=new f(u.player_1)));I=this.bracket3.matches;for(a in I)e=I[a],e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.tourneyData[t],u=this.tourneyData[v],null==this.bracket3.matches[t]&&(s.winner===s.player_1?this.bracket3.matches[t]=new f(s.player_2):this.bracket3.matches[t]=new f(s.player_1)),null==this.bracket3.matches[v]&&(u.winner===u.player_1?this.bracket3.matches[v]=new f(u.player_2):this.bracket3.matches[v]=new f(u.player_1)));J=this.bracket1.matches;for(a in J)e=J[a],("bye"===e.player_1||"bye"===e.player_2)&&(D="bye"===e.player_1?e.player_2:e.player_1,this.bracket1.matches[a]=new f(D),this.bracket1.matches[a].visible=!0);K=this.bracket1.matches;for(a in K)e=K[a],null!=e.previous_matches&&e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.bracket1.matches[t],u=this.bracket1.matches[v],!s.is_slot()&&u.is_slot()&&(e.previous_matches[0]=v,e.previous_matches[1]=t));L=this.bracket2.matches;for(a in L)e=L[a],("bye"===e.player_1||"bye"===e.player_2)&&(D="bye"===e.player_1?e.player_2:e.player_1,this.bracket2.matches[a]=new f(D));M=this.bracket2.matches;for(a in M)e=M[a],null!=e.previous_matches&&e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.bracket2.matches[t],u=this.bracket2.matches[v],!s.is_slot()&&u.is_slot()&&(e.previous_matches[0]=v,e.previous_matches[1]=t));N=this.bracket3.matches;for(a in N)e=N[a],("bye"===e.player_1||"bye"===e.player_2)&&(D="bye"===e.player_1?e.player_2:e.player_1,this.bracket3.matches[a]=new f(D));O=this.bracket3.matches;for(a in O)e=O[a],null!=e.previous_matches&&e.previous_matches.length>0&&(t=e.previous_matches[0].toString(),v=e.previous_matches[1].toString(),s=this.bracket3.matches[t],u=this.bracket3.matches[v],!s.is_slot()&&u.is_slot()&&(e.previous_matches[0]=v,e.previous_matches[1]=t));return this.currentDrawFunction=this.drawBracketFunc(this.bracket1),this.currentBracket=this.bracket1,this.fileLoaded=!0,this.redraw()},b.prototype.drawPlayerSlot=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q;if(q=d-c,h=f-e,n=q/2*this.canvas.width-this.rectWidth/2,o=h/2*this.canvas.height-this.rectHeight/2,this.context.beginPath(),this.context.rect(c*this.canvas.width+n,e*this.canvas.height+o,this.rectWidth,this.rectHeight),this.context.fillStyle=this.rectFill,this.context.strokeStyle=this.rectStroke,this.context.lineWidth=1,this.context.fill(),this.context.stroke(),g?(k=parseInt(c*this.canvas.width+n+this.rectWidth)+.5,l=parseInt(d*this.canvas.width)+.5):(k=parseInt(c*this.canvas.width)+.5,l=k+parseInt(n)),m=parseInt(e*this.canvas.height+o+this.rectHeight/2)+.5,this.context.beginPath(),this.context.moveTo(k,m),this.context.lineTo(l,m),this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.stroke(),b.isVisible()){for(p=b.player,i=0,j=0;this.context.measureText(p.substring(0,i+1)).width<this.rectWidth&&p.substring(0,i)!==p;)i++;if(p.substring(0,i)!==p)for(j=i;this.context.measureText(p.substring(i,j+1)).width<this.rectWidth&&!(j>=p.length);)j++;return this.context.font=this.textHeight+" Verdana",this.context.textAlign="center",this.context.fillStyle="#000000",0===j?this.context.fillText(p.substring(0,i),c*this.canvas.width+n+this.rectWidth/2,e*this.canvas.height+o+this.rectHeight/2+parseInt(this.textHeight)/2-1):(this.context.fillText(p.substring(0,i),c*this.canvas.width+n+this.rectWidth/2,e*this.canvas.height+o+this.rectHeight/2-3),this.context.textAlign="left",this.context.fillText(p.substring(i,j),c*this.canvas.width+n,e*this.canvas.height+o+this.rectHeight-3))}},b.prototype.drawMatch=function(a,b,c,d,e,g,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;switch(O=d-c,l=g-e,j){case"middle":F=O/2*this.canvas.width-this.rectWidth/2,G=l/2*this.canvas.height-this.rectHeight/2;break;case"bottom":F=O/2*this.canvas.width-this.rectWidth/2,G=l*this.canvas.height-this.rectHeight-5}if(this.context.beginPath(),this.context.rect(c*this.canvas.width+F,e*this.canvas.height+G,this.rectWidth,this.rectHeight),this.context.fillStyle=this.rectFill,this.context.strokeStyle=this.rectStroke,this.context.lineWidth=1,this.context.fill(),this.context.stroke(),b.click_field.x=c*this.canvas.width+F,b.click_field.y=e*this.canvas.height+G,b.click_field.w=this.rectWidth,b.click_field.h=this.rectHeight,p=parseInt(c*this.canvas.width)+.5,q=p+parseInt(F),r=q+parseInt(this.rectWidth),s=parseInt(d*this.canvas.width)+.5,t=parseInt(e*this.canvas.height+G+this.rectHeight/2)+.5,this.context.moveTo(p,t),this.context.lineTo(q,t),this.context.moveTo(r,t),this.context.lineTo(s,t),this.context.lineTo(s,v),this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.stroke(),b.isVisible()){for(N=b.is_slot()?b.player:b.winner,this.context.font=this.textHeight+" Verdana",this.context.textAlign="center",this.context.fillStyle="#000000",m=0,n=0;this.context.measureText(N.substring(0,m+1)).width<this.rectWidth&&N.substring(0,m)!==N;)m++;if(N.substring(0,m)!==N)for(n=m;this.context.measureText(N.substring(m,n+1)).width<this.rectWidth&&!(n>=N.length);)n++;0===n?this.context.fillText(N.substring(0,m),c*this.canvas.width+F+this.rectWidth/2,e*this.canvas.height+G+this.rectHeight/2+parseInt(this.textHeight)/2-1):(this.context.fillText(N.substring(0,m),c*this.canvas.width+F+this.rectWidth/2,e*this.canvas.height+G+this.rectHeight/2-3),this.context.textAlign="left",this.context.fillText(N.substring(m,n),c*this.canvas.width+F,e*this.canvas.height+G+this.rectHeight-3))}return 0===b.previous_matches.length?(I=e,J=e+l/2,L=J,M=g,H=new f(b.player_1),H.visible=!0,K=new f(b.player_2),K.visible=!0,this.context.beginPath(),o=i?c*this.canvas.width:d*this.canvas.width,u=I*this.canvas.height+(J-I)/2*this.canvas.height,v=L*this.canvas.height+(M-L)/2*this.canvas.height,this.context.moveTo(o,u),this.context.lineTo(o,v),this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.stroke(),void(i?(this.drawPlayerSlot(a,H,c-h,c,I,J,i),this.drawPlayerSlot(a,K,c-h,c,L,M,i)):(this.drawPlayerSlot(a,H,d,d+h,I,J,i),this.drawPlayerSlot(a,K,d,d+h,L,M,i)))):(y=b.previous_matches[0],C=b.previous_matches[1],x=a.matches[y],B=a.matches[C],z=e,x.is_slot()&&!B.is_slot()?(A=e+this.rectHeight/this.canvas.height+10/this.canvas.height,D=e):!x.is_slot()&&B.is_slot()?(A=g,D=g-this.rectHeight/this.canvas.height-10/this.canvas.height):(A=e+l/2,D=A),E=g,this.context.beginPath(),o=i?c*this.canvas.width:d*this.canvas.width,u=z*this.canvas.height+(A-z)/2*this.canvas.height,v=t=parseInt(e*this.canvas.height+G+this.rectHeight/2)+.5,w=this.rectHeight>l/2*this.canvas.height-this.rectHeight/2?!x.is_slot()&&B.is_slot()?A*this.canvas.height-this.rectHeight/2-5:x.is_slot()&&!B.is_slot()?E*this.canvas.height-this.rectHeight/2-5:D*this.canvas.height+(E-D)/2*this.canvas.height:D*this.canvas.height+(E-D)/2*this.canvas.height,this.context.moveTo(o,u),this.context.lineTo(o,v),this.context.lineTo(o,w),this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.stroke(),k=this.rectHeight>l/2*this.canvas.height-this.rectHeight/2?"bottom":"middle",i?(x.is_slot()?this.drawPlayerSlot(a,x,c-h,c,z,A,i):this.drawMatch(a,x,c-h,c,z,A,h,i,k),B.is_slot()?this.drawPlayerSlot(a,B,c-h,c,D,E,i):this.drawMatch(a,B,c-h,c,D,E,h,i,k)):(x.is_slot()?this.drawPlayerSlot(a,x,d,d+h,z,A,i):this.drawMatch(a,x,d,d+h,z,A,h,i,k),B.is_slot()?this.drawPlayerSlot(a,B,d,d+h,D,E,i):this.drawMatch(a,B,d,d+h,D,E,h,i,k)))},b.prototype.drawBracket=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(q=a.matches[a.lastmatch],s=q.previous_matches[0].toString(),u=q.previous_matches[1].toString(),r=a.matches[s],t=a.matches[u],b=this.depthRecurse(a,0,r),c=this.depthRecurse(a,0,t),console.log(""+b+" "+c),w=b===c?b+c+1:(b>c?b:c)+1,b===c?(f=1/w*b,g=f+1/w):(f=0,g=f+1/w),j=g-f,e=1,h=j/2*this.canvas.width-this.rectWidth/2,i=e/2*this.canvas.height-this.rectHeight/2,this.context.beginPath(),this.context.rect(f*this.canvas.width+h,i,this.rectWidth,this.rectHeight),this.context.fillStyle=this.rectFill,this.context.strokeStyle=this.rectStroke,this.context.lineWidth=1,this.context.fill(),this.context.stroke(),q.click_field.x=f*this.canvas.width+h,q.click_field.y=i,q.click_field.w=this.rectWidth,q.click_field.h=this.rectHeight,l=parseInt(f*this.canvas.width)+.5,m=l+parseInt(h),n=m+parseInt(this.rectWidth),o=parseInt(g*this.canvas.width)+.5,p=parseInt(i+this.rectHeight/2)+.5,this.context.beginPath(),b===c&&(this.context.moveTo(l,p),this.context.lineTo(m,p)),this.context.moveTo(n,p),this.context.lineTo(o,p),this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.stroke(),this.context.font=this.textHeight+" Verdana",this.context.textAlign="center",this.context.fillStyle="#000000",q.isVisible()){for(v=q.winner,d=0,k=0;this.context.measureText(v.substring(0,d+1)).width<this.rectWidth&&v.substring(0,d)!==v;)d++;if(v.substring(0,d)!==v)for(k=d;this.context.measureText(v.substring(d,k+1)).width<this.rectWidth&&!(k>=v.length);)k++;0===k?this.context.fillText(v.substring(0,d),f*this.canvas.width+h+this.rectWidth/2,i+this.rectHeight/2+parseInt(this.textHeight)/2-1):(this.context.fillText(v.substring(0,d),f*this.canvas.width+h+this.rectWidth/2,i+this.rectHeight/2-3),this.context.textAlign="left",this.context.fillText(v.substring(d,k),f*this.canvas.width+h,i+this.rectHeight-3))}return b===c?(r.is_slot()?this.drawPlayerSlot(a,r,f-1/w,f,0,1,1/w,!0):this.drawMatch(a,r,f-1/w,f,0,1,1/w,!0,"middle"),t.is_slot()?this.drawPlayerSlot(a,t,g,g+1/w,0,1,1/w,!1):this.drawMatch(a,t,g,g+1/w,0,1,1/w,!1,"middle")):r.is_slot()&&!t.is_slot()?(this.context.beginPath(),p=parseInt((this.rectHeight/this.canvas.height+10/this.canvas.height)/2*this.canvas.height)+.5,this.context.moveTo(g*this.canvas.width,p),this.context.lineTo(g*this.canvas.width,parseInt(.5*this.canvas.height)+.5),this.context.stroke(),this.drawPlayerSlot(a,r,g,g+1/w,0,this.rectHeight/this.canvas.height+10/this.canvas.height,!1),this.drawMatch(a,t,g,g+1/w,0,1,1/w,!1,"middle")):!r.is_slot()&&t.is_slot()&&(this.context.beginPath(),p=parseInt((this.rectHeight/this.canvas.height+10/this.canvas.height)/2*this.canvas.height)+.5,this.context.moveTo(g*this.canvas.width,p),this.context.lineTo(g*this.canvas.width,parseInt(.5*this.canvas.height)+.5),this.context.stroke(),this.drawMatch(a,r,g,g+1/w,0,1,1/w,!1,"middle"),this.drawPlayerSlot(a,t,g,g+1/w,0,this.rectHeight/this.canvas.height+10/this.canvas.height,!1)),this.drawBracketSwitcher()},b.prototype.drawChampBracket=function(){return this.champBracket.draw(this.context),this.drawBracketSwitcher()},b.prototype.drawBracketSwitcher=function(){var a,b,c,d,e,f,g,h,i;for(c=30,b=30,d=.5*this.canvas.width-c/2,e=.95*this.canvas.height-b/2,this.brackButtons[1].pos.w=c,this.brackButtons[1].pos.h=b,this.brackButtons[1].pos.x=d-(c/2+3),this.brackButtons[1].pos.y=e,this.brackButtons[1].text="2",this.brackButtons[1].color="#FFFFFF",this.brackButtons[1].func=function(a){return function(){return a.currentDrawFunction=a.drawBracketFunc(a.bracket2),a.currentBracket=a.bracket2,a.redraw()}}(this),this.brackButtons[0].pos.w=c,this.brackButtons[0].pos.h=b,this.brackButtons[0].pos.x=d-(3*c/2+8),this.brackButtons[0].pos.y=e,this.brackButtons[0].text="1",this.brackButtons[0].color="#FFFFFF",this.brackButtons[0].func=function(a){return function(){return a.currentDrawFunction=a.drawBracketFunc(a.bracket1),a.currentBracket=a.bracket1,a.redraw()}}(this),this.brackButtons[2].pos.w=c,this.brackButtons[2].pos.h=b,this.brackButtons[2].pos.x=d+(c/2+3),this.brackButtons[2].pos.y=e,this.brackButtons[2].text="3",this.brackButtons[2].color="#FFFFFF",this.brackButtons[2].func=function(a){return function(){return a.currentDrawFunction=a.drawBracketFunc(a.bracket3),a.currentBracket=a.bracket3,
a.redraw()}}(this),this.brackButtons[3].pos.w=c,this.brackButtons[3].pos.h=b,this.brackButtons[3].pos.x=d+(3*c/2+8),this.brackButtons[3].pos.y=e,this.brackButtons[3].text="C",this.brackButtons[3].color="#FFFFFF",this.brackButtons[3].func=function(a){return function(){return a.currentDrawFunction=a.drawChampBracket,a.currentBracket=a.champBracket,$(a.canvas).off("click"),$(a.canvas).on("click",a.champBracket.onclick),a.redraw()}}(this),h=this.brackButtons,i=[],f=0,g=h.length;g>f;f++)a=h[f],i.push(a.draw(this.context));return i},b.prototype.depthRecurse=function(a,b,c){var d,e,f,g,h,i;return c.is_slot()?b+1:0===c.previous_matches.length?b+2:(e=c.previous_matches[0].toString(),g=c.previous_matches[1].toString(),d=a.matches[e],f=a.matches[g],h=0,i=0,null!=d&&(h=this.depthRecurse(a,b+1,d)),null!=f&&(i=this.depthRecurse(a,b+1,f)),h>i?h:i)},b.prototype.resize=function(){return this.canvas.width=$(window).width()-5,this.canvas.height=$(window).height()-5,this.redraw(),console.log("resized")},b.prototype.redraw=function(){return this.canvas.width=this.canvas.width,null!==this.currentDrawFunction&&this.currentDrawFunction(this.context),console.log("redrawn")},b}(),h=new b}).call(this);